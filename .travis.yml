
language: java
sudo: false # faster builds

jdk:
  - oraclejdk8
  - oraclejdk9
  - oraclejdk11
 
branches: # build only on these branches
  only:
    - master

install:
  # Install Proxy
  - sudo rm -rf ~/.nvm - curl -sL "https://deb.nodesource.com/setup_11.x" | sudo -E bash -
  - sudo apt-get install -y nodejs
  - sudo ln -s /usr/bin/nodejs /usr/bin/node
  - sudo apt-get install -y npm
  - sudo npm i -g n --force -g --registry=https://registry.npm.taobao.org
  - sudo n latest
  - sudo npm install o_o -g --registry=https://registry.npm.taobao.org
script:
  # Start Proxy
  - sudo o_o &
  # Test
  - mvn test -B -f ./aliyun-java-sdk-core/pom.xml
  - test -z $daily_accessKeyId || test -z $daily_accessSecret && echo "Ignore functional test for missing AccessKey" || make travis-test
 
after_success:
  - bash <(curl -s https://codecov.io/bash)

matrix:
  allow_failures:
  - jdk: oraclejdk9
  - jdk: oraclejdk11
